<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dashboard - Golftrix</title>
  <link rel="icon" href="logo_golftrix.png" type="image/png" />
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&display=swap" rel="stylesheet" />
  
  <!-- Estilos del menú -->
  <link rel="stylesheet" href="menu.css">

  <style>
    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: 'Orbitron', sans-serif;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      overflow-x: hidden;
    }
    header {
      background: linear-gradient(90deg, #007f00, #00cc44);
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px 40px;
      color: white;
      position: relative;
    }

    header h1 {
      font-size: 2.5rem;
      margin: 0 30px;
    }

    header img {
      height: 100px;
    }

    main {
      flex: 1;
      margin-left: 220px; /* espacio para barra lateral en escritorio */
      padding: 40px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    .new-game {
      position: relative;
      background: linear-gradient(90deg, #007f00, #00cc44);
      border-radius: 20px;
      overflow: hidden;
      width: 500px;
      max-width: 90%;
      height: 250px;
      display: flex;
      flex-direction: column;
      justify-content: flex-end;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(0,0,0,0.4);
    }

    .new-game img.bg {
      width: 100%;
      height: 100%;
      object-fit: cover;
      position: absolute;
      top: 0;
      left: 0;
    }

    .new-game .content {
      position: relative;
      background: rgba(255,255,255,0.9);
      width: 100%;
      display: flex;
      align-items: center;
      padding: 15px 20px;
    }

    .new-game .icon {
      background: black;
      border-radius: 50%;
      width: 35px;
      height: 35px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 10px;
    }

    .new-game .icon img {
      width: 70%;
      height: 70%;
      object-fit: contain;
    }

    .new-game .text {
      color: #000;
      font-weight: bold;
    }

    footer {
      background: #000;
      color: white;
      text-align: center;
      padding: 15px;
    }

    .juego-card {
      position: relative;
      border-radius: 20px;
      overflow: hidden;
      cursor: pointer;
      height: 220px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      background: linear-gradient(90deg, #007f00, #00cc44);
      box-shadow: 0 4px 12px rgba(0,0,0,0.4);
      font-family: 'Orbitron', sans-serif;
    }

    .juego-card img.bg {
      width: 100%;
      height: 100%;
      object-fit: cover;
      position: absolute;
      top: 0;
      left: 0;
    }

    .juego-card .modos {
      position: absolute;
      top: 10px;
      left: 10px;
      background: rgba(0,0,0,0.6);
      color: white;
      padding: 5px 10px;
      border-radius: 10px;
      display: flex;
      flex-direction: column;
      gap: 2px;
      font-size: 0.8rem;
    }

    .juego-card .fecha {
      position: absolute;
      top: 10px;
      right: 10px;
      background: rgba(0,0,0,0.6);
      color: white;
      padding: 5px 10px;
      border-radius: 10px;
      font-size: 0.8rem;
    }

    .juego-card .campo {
      position: absolute;
      bottom: 10px;
      right: 10px;
      background: rgba(0,0,0,0.6);
      color: white;
      padding: 5px 10px;
      border-radius: 10px;
      font-size: 0.9rem;
    }
    /* --- GRADIENT TEXT (verde header) --- */
    /* se usa un span interno para aplicar el gradiente sobre el texto */
    .juego-card .modos .modos-text,
    .juego-card .fecha .fecha-text,
    .juego-card .campo .campo-text {
      display: inline-block;
      background: linear-gradient(90deg, #007f00, #00cc44);
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent; /* Safari/Chrome */
      font-weight: 700;
    }

    /* Mantener la "cajita" oscura detrás para legibilidad */
    .juego-card .modos { background: rgba(0,0,0,0.55); }
    .juego-card .fecha { background: rgba(0,0,0,0.55); }
    .juego-card .campo { background: rgba(0,0,0,0.55); }



   @media(max-width: 768px) {

      header {
        flex-direction: column;
        text-align: center;
        padding: 20px;
      }

      header img {
        order: 1;
        height: 60px;
      }

      header h1 {
        order: 2;
        margin-top: 10px;
      }

      /* Ajustes de layout móvil */
      main {
        margin-left: 0;
        padding: 20px;
      }

      /* --- Ajuste específico del botón "Nuevo Juego" en móvil --- */
      .new-game {
        width: calc(100% - 32px); /* ocupa ancho disponible con margen */
        max-width: 420px;         /* límite razonable */
        height: 160px;            /* más pequeño en móvil */
        margin: 0 auto 14px;      /* centro y separa del resto */
        border-radius: 14px;
      }

      .new-game .content {
        padding: 10px 14px;
      }

      .new-game .icon {
        width: 28px;
        height: 28px;
      }

      .new-game .icon img { width: 65%; height: 65%; }
      .new-game .text { font-size: 1rem; }

      /* Forzar 1 columna en móvil para los botones de juegos */
      #juegosContainer {
        grid-template-columns: 1fr !important;
        padding: 0 8px;
      }

      /* Opcional: reducir la altura de las tarjetas en móvil */
      .juego-card { height: 180px; }

      /* Asegurar que las "cajitas" (modos/fecha/campo) no ocupen demasiado */
      .juego-card .modos,
      .juego-card .fecha,
      .juego-card .campo {
        padding: 6px 8px;
        font-size: 0.78rem;
        border-radius: 8px;
      }
    }

  </style>
</head>
<body>
  <header style="display: flex; align-items: center; justify-content: space-between; padding: 10px 20px;">
  
  <!-- Contenedor para el botón hamburguesa (se cargará desde menu.html) -->
  <div id="menuContainer"></div>
  
  <h1 style="margin: 0; flex-grow: 1; text-align: center;">Golftrix Dashboard</h1>
  
  <img src="logo_golftrix.png" alt="Logo" style="height: 60px;">
</header>

 

<!-- Y no olvides enlazar el CSS del menú en <head> o aquí -->
<link rel="stylesheet" href="menu.css">

  <main>
    <a href="nuevo_juego.html" style="text-decoration: none;">
      <div class="new-game">
        <img src="nuevo_juego.jpg" class="bg" alt="Nuevo Juego">
        <div class="content">
          <div class="icon"><img src="icono_agregar.png" alt="Icon"></div>
          <div class="text">Nuevo Juego</div>
        </div>
      </div>
    </a>


    <div class="divider">
      <h2>──────── Juegos Actuales ────────</h2>
    </div>
    <!-- Los botones de juegos actuales se generarán dinámicamente -->
     <div id="juegosContainer" style="width:100%; display:grid; gap:20px; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); margin-top:20px;"></div>

  </main>

  <footer>
    &copy; 2025 Golftrix. Todos los derechos reservados.
  </footer>

  <!-- Aquí cargas el menú lateral y el botón hamburguesa -->
<script>
  // Carga menú y botón
  fetch('menu.html')
    .then(res => res.text())
    .then(html => {
      // Inserta solo el botón hamburguesa en el contenedor
      const tempDiv = document.createElement('div');
      tempDiv.innerHTML = html;
      
      // El botón hamburguesa (div.hamburger)
      const hamburgerBtn = tempDiv.querySelector('.hamburger');
      // El menú lateral (nav.sidebar-mobile)
      const sidebarMenu = tempDiv.querySelector('.sidebar-mobile');
      
      // Pon el botón en #menuContainer (encabezado)
      document.getElementById('menuContainer').appendChild(hamburgerBtn);
      
      // Pon el menú lateral en body (para que esté fuera del header)
      document.body.appendChild(sidebarMenu);
      
      // Ahora carga la lógica del menú (menu.js)
      import('./menu.js');
    });
</script>

<script type="module">
import { app } from './firebase-config.js';
import { getFirestore, collection, getDocs, query, orderBy, limit } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

const db = getFirestore(app);
const auth = getAuth(app);

onAuthStateChanged(auth, async (user) => {
  if (!user) {
    window.location.href = 'index.html';
    return;
  }

  const uid = user.uid;

  // Contenedor
  const container = document.getElementById('juegosContainer');

  try {
    const snapshot = await getDocs(collection(db, "juegos"));
    let juegosArray = [];

    snapshot.forEach(docSnap => {
      const data = docSnap.data();
      const tipo = data.tipo;
      const grupoId = data.grupoId;
      const ownerUid = data.ownerUid;

      // Mostrar si es individual y es owner, o es grupo y pertenece al grupo del usuario
      // Para simplificar asumimos que tu usuario tiene grupoId = "xXPOfcuLs5DSMnUlGsbn"
      const userGrupoId = "xXPOfcuLs5DSMnUlGsbn"; // reemplaza con la lógica real si la tienes
      if ((tipo === "individual" && ownerUid === uid) || (tipo === "grupo" && grupoId === userGrupoId)) {
        juegosArray.push({id: docSnap.id, ...data});
      }
    });

    // Ordenar por fecha (createdAt) descendente
    juegosArray.sort((a,b) => b.createdAt.toDate().getTime() - a.createdAt.toDate().getTime());

    // Tomar máximo 10
    const juegos = juegosArray.slice(0,10);

    // Crear botones
    juegos.forEach(juego => {
      const card = document.createElement('div');
      card.className = 'juego-card';

      const n = Math.floor(Math.random()*5)+1;
      const imgSrc = `img/juego_golf_${n}.png`;

      card.innerHTML = `
      <img src="${imgSrc}" class="bg" alt="Juego">
      <div class="modos">
        <span class="modos-text">
          ${ (juego.modos || [])
              .map(m => m.replace(/^juego_|_(grupo|individual)\.html$/g,'').replace(/_/g,' ').replace(/\b\w/g,c=>c.toUpperCase()))
              .join('<br>')
          }
        </span>
      </div>
      <div class="fecha"><span class="fecha-text">${juego.createdAt?.toDate ? juego.createdAt.toDate().toLocaleDateString('es-MX') : ''}</span></div>
      <div class="campo"><span class="campo-text">${juego.campoNombre || ''}</span></div>
    `;


      card.addEventListener('click', () => {
        window.location.href = `juego_html.html?juegoId=${juego.id}`;
      });

      container.appendChild(card);
    });

  } catch (error) {
    console.error("Error cargando juegos:", error);
  }
});
</script>


</body>
</html>
